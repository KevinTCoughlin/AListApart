<div class="ajax-container">

	{exp:ajaxauth:login	id="login_form"	name="login_form" class="sign-in-form" return="ajax/comment-form/{segment_3}/{segment_4}/{segment_5}" post_process="alert_msg"}

		<fieldset>

	    	<legend class="center">Sign in with your A List Apart account to discuss this article.</legend>

			<p>
				<label for="login-name-here">Email / Username (<a id="register-link" data-tabto="forgot-link" href="/tools/register" target="_blank">need an account?</a>)</label>
				<input
					type="text"
					id="login-name-here"
					name="username"
					data-validate="onblur"
					data-type="any"
					data-isvalid=""
					data-error="who are you?"
					data-tabmaster="true"
					data-tabto="login_password"
					required>
			</p>
			<p class="password-field">
				<label for="login_password">Password (<a id="forgot-link" data-tabto="comment-submit" href="/tools/forgot-password" target="_blank">forgotten it?</a>)</label>
				<input
					type="password"
					id="login_password"
					name="password"
					required="required"
					data-validate="onblur"
					data-type="any"
					data-isvalid=""
					data-error="what's your password?"
					data-tabto="register-link"
					required>
			</p>
			<p class="screen-reader">
				<label for="honeepot">Don't put anything here</label>
				<input 
					type="text" 
					id="honeepot" 
					name="honeepot"
					data-tabmaster="false">
			</p>
			<p>
				<input 
					type="submit" 
					id="comment-submit"
					class="button primary float-left" 
					data-tabmaster="false" 
					value="Submit">
			</p>
			
		</fieldset>

		{loader}{/loader}

	{/exp:ajaxauth:login}

	<script type="text/javascript">

	var states = {
		segments: '/{segment_4}/{segment_5}/',
		site_url: '{site_url}',
		path: /ajax/,
		entry_id: '/{segment_3}',
		commentsignin: {
			url: 'comment-sign-in'
		},
		register: {
			url: 'register',
			clickId: 'register-link',
			backId: 'cancel-registration'
		},
		forgotpassword: {
			url: 'forgot-password',
			clickId: 'forgot-link',
			backId: 'cancel-password-reset'
		},
		commentform: {
			url: 'comment-form'
		}
	}

	document.getElementById(states.register.clickId).addEventListener('click', function(event){

		event.preventDefault();
		//hide current template and load new template
		loadTemplate(states.path, states.register.url, states.entry_id + states.segments);
		// Add item to the history log
		history.pushState(states.register, document.title, '{site_url}' + states.segments + states.register.url);

	}, false);

	document.getElementById(states.forgotpassword.clickId).addEventListener('click', function(event){

		event.preventDefault();
		//hide current template and load new template
		loadTemplate(states.path, states.forgotpassword.url, states.entry_id + states.segments);
		// Add item to the history log
		history.pushState(states.forgotpassword, document.title, '{site_url}' + states.segments + states.forgotpassword.url);

	}, false);
	// Add current template to the history log
	history.pushState(states.commentsignin, document.title, '{site_url}' + states.segments + states.commentsignin.url);

	//popstate event only needs to be on original template (associated with the back function)
	$(window).on("popstate", function(e) {
		if (e.originalEvent.state !== null) {
			loadTemplate('{site_url}' + states.path, states.commentsignin.url, states.entry_id + states.segments);
		}
	});

	$.getScript( "{site_url}/components/assets/js/ajax-functions.js" )
	  .done(function( script, textStatus ) {
	    console.log( textStatus );
	  })
	  .fail(function( jqxhr, settings, exception ) {
	     console.log("Triggered ajaxError handler.");
	});

	</script>

</div>
